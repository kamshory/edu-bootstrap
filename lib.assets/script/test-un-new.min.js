function saveAnswer(e){let t=testDataJSON.answer.answer_id,a=testDataJSON.test.test_id;$.ajax({type:"POST",url:"siswa/simpan-jawaban.php",dataType:"json",data:{test_id:a,answer_id:t,answer:e},success:function(e){console.log(e)},error:function(e){console.log(e)}})}function updateQuestionSelector(e){let t=testData[lastIndex],a=t.question_id;answer[a]=void 0===answer[a]?{}:answer[a],answer[a].answerId=e,window.localStorage.setItem(keyAnswer,JSON.stringify(answer)),setActiveNumber(testData,lastIndex,selector1,selector2,answer)}function doubtfulAnswer(){let e=testData[lastIndex],t=e.question_id;answer[t]=void 0===answer[t]?{}:answer[t];let a=answer[t].doubtful||!1;answer[t].doubtful=!a,window.localStorage.setItem(keyAnswer,JSON.stringify(answer)),setActiveNumber(testData,lastIndex,selector1,selector2,answer),markDoubtful(testData,lastIndex,selector1,selector2,answer)}function prev(){lastIndex>0&&(lastIndex--,window.localStorage.setItem(keyIndex,lastIndex),changeIndex(testData,lastIndex,selector1,selector2,answer))}function next(){lastIndex<testData.length-1&&(lastIndex++,window.localStorage.setItem(keyIndex,lastIndex),changeIndex(testData,lastIndex,selector1,selector2,answer))}function changeIndex(e,t,a,n,s){renderQuestion(e,t,a,s),setAnswer(e,t,a,n,s),setActiveNumber(e,t,a,n,s),markDoubtful(e,t,a,n,s)}function setActiveNumber(e,t,a,n,s){let r=n+' li[data-index="'+t+'"]',o=$(r);o.siblings().removeClass("active"),o.addClass("active");let i=e[t],l=i.question_id;if(void 0!==s[l]){let e=""!=(s[l].answerId||"");o.attr({"data-answered":e?"true":"false"})}}function setAnswer(e,t,a,n,s){let r=e[t],o=r.question_id;if(void 0!==s[o]){let e=s[o].answerId||"",t=$(a),n="#option_"+e;""!=e&&t.find(n).length&&(t.find(n)[0].checked=!0)}}function markDoubtful(e,t,a,n,s){let r=e[t],o=r.question_id;if(void 0!==s[o]){let e=s[o].doubtful||!1,a=n+' li[data-index="'+t+'"]',r=$(a);r.attr({"data-doubtful":e?"true":"false"}),$("body").attr("data-doubtful",e?"true":"false");let i=""!=(s[o].answerId||"");r.attr({"data-doubtful":e?"true":"false"}),r.attr({"data-answered":i?"true":"false"})}}function renderQuestion(e,t,a,n){let s=e[t],r=s.question_id,o=$(a),i=o.find(".test-option-area"),l=o.find(".test-question-area");i.empty(),l.empty(),l.append(s.content);for(let e in s.option){let a=s.option[e],n=$("<div />"),o=$("<div />");n.addClass("test-option"),o.addClass("option-control");let l=$("<input />"),d=$("<label />"),c=$("<span />");l.attr({type:"radio","data-index":t,"data-question-id":r,name:"option_"+r,id:"option_"+a.option_id,value:a.option_id}),d.attr({for:"option_"+a.option_id}),c.text(getNumber(numberingList,s.numbering,e)),d.append(c),o.append(l).append(d),n.append(o).append(a.content),i.append(n)}}function getNumber(e,t,a){let n=e[t];return n[parseInt(a)]}function renderQuestionSelector(e,t,a,n){let s=$("<ul />");for(let a in e){let r=e[a],o=r.question_id,i=parseInt(a)+1,l=$("<li />");if(l.attr({"data-index":a}),a==t&&l.addClass("active"),void 0!==n[o]){let e=n[o].doubtful||!1,t=""!=(n[o].answerId||"");l.attr({"data-doubtful":e?"true":"false"}),l.attr({"data-answered":t?"true":"false"})}let d=$("<a />");d.attr({href:"#"}),d.text(i),l.append(d),s.append(l)}$(a).empty().append(s)}let testData=[];"undefined"!=typeof testDataJSON&&(testData=testDataJSON.data);let numberingList={"upper-alpha":["A","B","C","D","E","F","G","H","I","J"],"lower-alpha":["a","b","c","d","e","f","g","h","i","j"],"upper-roman":["I","II","III","IV","V","VI","VII","VIII","IX","X"],"lower-roman":["i","ii","iii","iv","v","vi","vii","vii","ix","x"],decimal:["1","2","3","4","5","6","7","8","9","10"],"decimal-leading-zero":["01","02","03","04","05","06","07","08","09","10"]},keyIndex="picoedu_last_index_"+testStudentId,keyAnswer="picoedu_answer_"+testStudentId,lastIndexStr=window.localStorage.getItem(keyIndex)||"0",lastIndex=parseInt(lastIndexStr);isNaN(lastIndex)&&(lastIndex=0);let selector1=".test-wrapper",selector2=".selector-wrapper",answerStr=window.localStorage.getItem(keyAnswer)||"{}",answer={};try{answer=JSON.parse(answerStr)}catch(e){answer={}}$(document).ready(function(){$(document).on("click",selector2+" li a",function(e){e.preventDefault();let t=$(this);t.parent().siblings().removeClass("active"),t.parent().addClass("active");let a=t.parent().attr("data-index"),n=parseInt(a);isNaN(n)&&(n=0),lastIndex=n,window.localStorage.setItem(keyIndex,n),renderQuestion(testData,n,selector1,answer),setAnswer(testData,n,selector1,selector2,answer),setActiveNumber(testData,n,selector1,selector2,answer),markDoubtful(testData,n,selector1,selector2,answer)}),$(document).on("change",selector1+" .test-option-area .option-control input",function(e){e.preventDefault();let t=$(this);t.parent().siblings().removeClass("active"),t.parent().addClass("active");let a=t.attr("data-index"),n=t.attr("data-question-id"),s=t.val();answer[n]=void 0===answer[n]?{}:answer[n],answer[n].answerId=s,window.localStorage.setItem(keyAnswer,JSON.stringify(answer)),setActiveNumber(testData,a,selector1,selector2,answer),saveAnswer(JSON.parse(JSON.stringify(answer)))}),$(document).on("click",".button-doubtful",function(e){doubtfulAnswer()}),$(document).on("click",".button-prev",function(e){prev()}),$(document).on("click",".button-next",function(e){next()}),$("#sidebarCollapse").on("click",function(){$("#sidebar").toggleClass("active")}),$(document).on("keydown","body",function(e){let t=e.key;t=t.toUpperCase(),t=="ArrowRight".toUpperCase()&&next(),t=="ArrowLeft".toUpperCase()&&prev(),"R"==t&&doubtfulAnswer(),$(".test-option-area .option-control").each(function(e){if($(this).find("label").text().trim()==t){$(this).find("input")[0].checked=!0;let e=$(this).find("input").val();updateQuestionSelector(e),saveAnswer(JSON.parse(JSON.stringify(answer)))}})}),renderQuestion(testData,lastIndex,selector1,answer),renderQuestionSelector(testData,lastIndex,selector2,answer),setAnswer(testData,lastIndex,selector1,selector2,answer),setActiveNumber(testData,lastIndex,selector1,selector2,answer),markDoubtful(testData,lastIndex,selector1,selector2,answer)});