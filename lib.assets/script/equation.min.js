window.onload=function(){var rendererSelector="mathjax-svg";document.getElementById("renderer").value="mathjax-svg"};var generatePNG=!0;function replaceAllText(input,findStr,replaceStr){var arr;return input.split(findStr).join(replaceStr)}function insertEquation(includeLatex){var jsonObj=$(".eqEdEquation").data("eqObject").buildJsonObj(),latex=generateLatex(jsonObj.operands.topLevelContainer);latex=asciimath.reconstructSqrtWord(latex),latex=asciimath.filterData(latex),latex=asciimath.reconstructMatrix(latex),latex=asciimath.reconstructVector(latex);var rendererSelector=document.getElementById("renderer").value;if("server-png"==rendererSelector){if(latex.length>0){var urlGenerator=window.parent.equationURLGenerator||"../cgi-bin/equgen.cgi",urlPreview=window.parent.equationURLPreview||"../cgi-bin/equgen.cgi",url=urlGenerator+"?"+latex,img=new Image,canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");img.onload=function(){canvas.setAttribute("width",img.width),canvas.setAttribute("height",img.height),ctx.drawImage(img,0,0);var dataURL=canvas.toDataURL("png");includeLatex?window.parent.uploadBase64ImageFromLatex(dataURL,2,"png","latex|"+latex):window.parent.uploadBase64ImageFromLatex(dataURL,2,"png")},img.src=url}}else if("mathjax-svg"==rendererSelector){if(""!=latex){let img=document.createElement("img"),data=MathJax.tex2svg(latex).firstElementChild.outerHTML+"",url="data:image/svg+xml;base64,"+Base64.encode(data);includeLatex?window.parent.uploadBase64ImageFromLatex(url,1,"svg","latex|"+latex):window.parent.uploadBase64ImageFromLatex(url,1,"svg")}}else if("mathjax-png"==rendererSelector){if(""!=latex){let img=document.createElement("img"),data;svgToPNG(MathJax.tex2svg(latex).firstElementChild.outerHTML+"",(function(base64EncodedURL){includeLatex?window.parent.uploadBase64ImageFromLatex(base64EncodedURL,1,"png","latex|"+latex):window.parent.uploadBase64ImageFromLatex(base64EncodedURL,1,"png")}))}}else if("browser-svg"==rendererSelector){var data=asciimath.latexToSVG(latex,!0,!0);includeLatex?window.parent.uploadBase64ImageFromLatex("data:image/svg+xml;base64,"+Base64.encode(data),1,"svg","latex|"+latex):window.parent.uploadBase64ImageFromLatex("data:image/svg+xml;base64,"+Base64.encode(data),1,"svg")}else{var data;svgToPNG(data=asciimath.latexToSVG(latex,!0,!0),(function(base64EncodedURL){includeLatex?window.parent.uploadBase64ImageFromLatex(base64EncodedURL,1,"png","latex|"+latex):window.parent.uploadBase64ImageFromLatex(base64EncodedURL,1,"png")}))}}function svgToPNG(svgData,onloadCallback){var DOMURL=window.URL||window.webkitURL||window,img=new Image,svg=new Blob([svgData],{type:"image/svg+xml"}),url=DOMURL.createObjectURL(svg),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");img.onload=function(){canvas.setAttribute("width",img.width),canvas.setAttribute("height",img.height),ctx.drawImage(img,0,0),DOMURL.revokeObjectURL(url),onloadCallback(canvas.toDataURL("png"))},img.src=url}