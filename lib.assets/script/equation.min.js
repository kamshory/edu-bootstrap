window.onload=function(){let equgen=window.parent.equationRenderer||"browser";document.getElementById("renderer").value=equgen};let generatePNG=!0;function replaceAllText(input,findStr,replaceStr){let arr;return input.split(findStr).join(replaceStr)}function insertEquation(includeLatex){let jsonObj=$(".eqEdEquation").data("eqObject").buildJsonObj(),latex=generateLatex(jsonObj.operands.topLevelContainer);latex=asciimath.reconstructSqrtWord(latex),latex=asciimath.filterData(latex),latex=asciimath.reconstructMatrix(latex),latex=asciimath.reconstructVector(latex);let equgen=document.getElementById("renderer").value;if("server-png"==equgen){if(latex.length>0){let urlGenerator,url=(window.parent.equationURLGenerator||"../cgi-bin/equgen.cgi")+"?"+latex,img=new Image,canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");img.onload=function(){canvas.setAttribute("width",img.width),canvas.setAttribute("height",img.height),ctx.drawImage(img,0,0);let dataURL=canvas.toDataURL("png");includeLatex?window.parent.uploadBase64ImageFromLatex(dataURL,2,"png","latex|"+latex):window.parent.uploadBase64ImageFromLatex(dataURL,2,"png")},img.src=url}}else if("browser-mathml"==equgen){let data=asciimath.latexToSVG(latex,!0,!0);includeLatex?window.parent.uploadBase64ImageFromLatex("data:image/svg+xml;base64,"+Base64.encode(data),1,"svg","latex|"+latex):window.parent.uploadBase64ImageFromLatex("data:image/svg+xml;base64,"+Base64.encode(data),1,"svg")}else{let data=asciimath.latexToSVG(latex,!0,!0),DOMURL=window.URL||window.webkitURL||window,img=new Image,svg=new Blob([data],{type:"image/svg+xml"}),url=DOMURL.createObjectURL(svg),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");img.onload=function(){canvas.setAttribute("width",img.width),canvas.setAttribute("height",img.height),ctx.drawImage(img,0,0),DOMURL.revokeObjectURL(url),includeLatex?window.parent.uploadBase64ImageFromLatex(canvas.toDataURL("png"),1,"png","latex|"+latex):window.parent.uploadBase64ImageFromLatex(canvas.toDataURL("png"),1,"png")},img.src=url}}