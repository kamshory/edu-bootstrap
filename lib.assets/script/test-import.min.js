let last_id="";function previewFile(id){let i;$.ajax({cache:!0,url:"ajax-preview-question-store.php",type:"GET",dataType:"html",data:{id:id},success:function(answer){$(".file-preview").empty().append(answer);let arr=loadSelection(id);if(void 0!==arr&&null!=arr){for(i in arr)0==arr[i]||"0"==arr[i]?$('.select-question[data-index="'+i+'"]').attr("data-selected","false"):$('.select-question[data-index="'+i+'"]').attr("data-selected","true");$(".file-preview").attr("data-selection",JSON.stringify(arr))}}})}function loadSelection(col){let data=window.localStorage.getItem("col"+col),arr;return JSON.parse(data)}function storeSelection(col,data){window.localStorage.setItem("col"+col,data),$(".file-preview").attr("data-selection",data)}$(document).ready((function(e){$(document).on("change","#gradefrm select",(function(e){$(this).closest("form").submit()})),$(document).on("click",".file-list ul li a",(function(e){$(".file-list ul li").removeClass("test-selected"),$(this).parent().addClass("test-selected");let id=$(this).attr("data-id");$(".test-selector-container").fadeOut(10),id!=last_id&&(previewFile(id),last_id=id,$(".collection-preview-container").attr("data-id",id)),e.preventDefault()})),$(document).on("click",".select-existing",(function(e){let obj=$(this),left=obj.offset().left,right,center=(obj.width()+left+left)/2,top=obj.offset().top+obj.height()+26;left=center-240,$(".test-selector-container").css({left:left,top:top}).fadeIn(100),e.preventDefault()})),$(document).on("click",".create-new",(function(e){let obj=$(this),selection=$(".file-preview").attr("data-selection")||"",id=obj.closest(".collection-preview-container").attr("data-id");window.open("ujian.php?option=add&import=yes&collection="+id+"&selection="+selection),e.preventDefault()})),$(document).on("click",".close-test-selector a",(function(e){$(".test-selector-container").fadeOut(100),e.preventDefault()})),$(document).on("click",".import-question",(function(e){if(confirm("Apakah Anda akan mengimpor soal ke ujian ini?")){let to=$(this).attr("data-test-id"),from=$(".collection-preview-container").attr("data-id"),selection=$(".file-preview").attr("data-selection")||"";$.post("ajax-ujian-impor.php",{from:from,to:to,selection:selection},(function(answer){$(".test-selector-inner").empty().append(answer),alert("Soal ujian sudah diimpor")}))}e.preventDefault()})),$(document).on("click",".select-question",(function(e){let sel=$(this).attr("data-selected")||"false";sel="true"==sel?"false":"true",$(this).attr("data-selected",sel);let json=[];$(".select-question").each((function(index,element){let sel=$(this).attr("data-selected")||"false",idx=parseInt($(this).attr("data-index"));json[idx]="true"==sel?1:0}));let data=JSON.stringify(json),col;storeSelection($(this).closest(".question-text-area").attr("data-collection-id"),data),e.preventDefault()}))}));