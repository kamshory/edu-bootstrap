function renderLatex(e){let t=document.getElementById("renderer").value,a=(window.parent.equationURLGenerator,window.parent.equationURLPreview||"../cgi-bin/equgen.cgi");if("server-png"==t)if(e.length>0){let t=a+"?"+e,n=document.createElement("img");n.src=t,n.setAttribute("alt",e),n.setAttribute("data-latex",e),n.setAttribute("class","latex-image"),n.style.verticalAlign="middle";let i=n.outerHTML;document.getElementById("image-container").innerHTML=i}else document.getElementById("image-container").innerHTML="";else if("browser-mathjax"==t)if(""!=e){let t=document.createElement("img"),a=MathJax.tex2svg(e).firstElementChild.outerHTML+"",n="data:image/svg+xml;base64,"+Base64.encode(a);t.src=n,t.setAttribute("alt",e),t.setAttribute("class","latex-image"),t.style.verticalAlign="middle",document.getElementById("image-container").innerHTML=t.outerHTML}else document.getElementById("image-container").innerHTML="";else{let t=asciimath.latexToSVG(e),a="data:image/svg+xml;base64,"+Base64.encode(t),n=document.createElement("img");n.src=a,n.setAttribute("alt",e),n.setAttribute("data-latex",e),n.setAttribute("class","latex-image"),n.style.verticalAlign="middle";let i=n.outerHTML;document.getElementById("image-container").innerHTML=i}}function decodeLatexFromURI(e){return e.indexOf("#latex%7C")>-1&&(e=e.substr(e.indexOf("#latex%7C")+9),e=decodeURIComponent(e)),e}function contains(e,t){for(let a in e)if(e[a].toLowerCase()==t.toLowerCase())return!0;return!1}function isContetRTF(e){return contains(e,"text/html")||contains(e,"text/rtf")}function handlePasteImage(e){let t="";if(e&&e.clipboardData&&e.clipboardData.getData)if(isContetRTF(e.clipboardData.types)){document.getElementById("renderer").value="browser-png",t=e.clipboardData.getData("text/plain");try{t=asciimath.reconstructSqrtWord(t),t=asciimath.filterData(t),t=asciimath.reconstructMatrix(t),t=asciimath.reconstructVector(t),e.clipboardData.setData("text/html",t),document.getElementById("latex-input").value=t,renderLatex(t)}catch(e){t=asciimath.reconstructSqrtWord(t),t=asciimath.filterData(t),t=asciimath.reconstructMatrix(t),t=asciimath.reconstructVector(t),renderLatex(t),document.getElementById("latex-input").value=t}e.preventDefault&&(e.stopPropagation(),e.preventDefault())}else t=e.clipboardData.getData("text/plain"),t=asciimath.filterData(t),t=asciimath.reconstructMatrix(t),t=asciimath.reconstructVector(t),setTimeout(function(){""!=t&&(document.getElementById("latex-input").value=t)},10),renderLatex(t)}function insertEquation(e){let t=document.getElementById("latex-input").value,a=document.getElementById("renderer").value;if("server-png"==a){if(t.length>0){t=asciimath.reconstructSqrtWord(t),t=asciimath.filterData(t),t=asciimath.reconstructMatrix(t),t=asciimath.reconstructVector(t);let a=window.parent.equationURLGenerator||"../cgi-bin/equgen.cgi",n=a+"?"+t,i=new Image,r=document.createElement("canvas"),c=r.getContext("2d");i.onload=function(){r.setAttribute("width",i.width),r.setAttribute("height",i.height),c.drawImage(i,0,0);let a=r.toDataURL("png");e?window.parent.uploadBase64ImageFromLatex(a,2,"png","latex|"+t):window.parent.uploadBase64ImageFromLatex(a,2,"png")},i.src=n}}else if("browser-mathjax"==a){if(""!=t){document.createElement("img");let a=MathJax.tex2svg(t).firstElementChild.outerHTML+"",n="data:image/svg+xml;base64,"+Base64.encode(a);e?window.parent.uploadBase64ImageFromLatex(n,1,"svg","latex|"+t):window.parent.uploadBase64ImageFromLatex(n,1,"svg")}}else if("browser-mathml"==a){let a=asciimath.latexToSVG(t,!0,!0);e?window.parent.uploadBase64ImageFromLatex("data:image/svg+xml;base64,"+Base64.encode(a),2,"svg","latex|"+t):window.parent.uploadBase64ImageFromLatex("data:image/svg+xml;base64,"+Base64.encode(a),2,"svg")}else{let a=asciimath.latexToSVG(t,!0,!0),n=window.URL||window.webkitURL||window,i=new Image,r=new Blob([a],{type:"image/svg+xml"}),c=n.createObjectURL(r),o=document.createElement("canvas"),l=o.getContext("2d");i.onload=function(){o.setAttribute("width",i.width),o.setAttribute("height",i.height),l.drawImage(i,0,0),n.revokeObjectURL(c),e?window.parent.uploadBase64ImageFromLatex(o.toDataURL("png"),2,"png","latex|"+t):window.parent.uploadBase64ImageFromLatex(o.toDataURL("png"),2,"png")},i.src=c}}window.onload=function(e){let t="browser-mathjax";document.getElementById("renderer").value=t,document.getElementById("renderer").addEventListener("change",function(e){let t=document.getElementById("latex-input").value;t=asciimath.filterData(t),t=asciimath.reconstructMatrix(t),t=asciimath.reconstructVector(t),renderLatex(t)}),document.getElementById("latex-input").addEventListener("change",function(e){let t=e.target.value;t=asciimath.filterData(t),t=asciimath.reconstructMatrix(t),t=asciimath.reconstructVector(t),renderLatex(t)}),document.getElementById("latex-input").addEventListener("keyup",function(e){let t=e.target.value;t=asciimath.filterData(t),t=asciimath.reconstructMatrix(t),t=asciimath.reconstructVector(t),renderLatex(t)}),document.getElementById("latex-input").addEventListener("blur",function(e){let t=e.target.value;t=asciimath.filterData(t),t=asciimath.reconstructMatrix(t),t=asciimath.reconstructVector(t),renderLatex(t)}),document.getElementById("latex-input").addEventListener("focus",function(e){let t=e.target.value;t=asciimath.filterData(t),t=asciimath.reconstructMatrix(t),t=asciimath.reconstructVector(t),renderLatex(t)}),document.getElementById("latex-input").addEventListener("paste",handlePasteImage);let a=document.location.toString();if(a.indexOf("arg=")>-1){let e=a.substr(a.indexOf("arg=")+4);e=decodeURIComponent(e),e=e.trim(),0===e.indexOf("$$")&&(e=e.substr(2)),"$$"==e.substr(e.length-2,2)&&(e=e.substr(0,e.length-2)),e=decodeLatexFromURI(e),e=asciimath.reconstructSqrtWord(e),e=asciimath.filterData(e),e=asciimath.reconstructMatrix(e),e=asciimath.reconstructVector(e),document.getElementById("latex-input").value=e}document.getElementById("latex-input").focus();let n=document.getElementById("latex-input").value;renderLatex(n)};let generatePNG=!0;