function renderLatex(t){let e=document.getElementById("renderer").value;if(""!=t)if("mathjax-svg"==e){let e=document.createElement("img"),a=MathJax.tex2svg(t).firstElementChild.outerHTML+"",n="data:image/svg+xml;base64,"+Base64.encode(a);e.src=n,e.setAttribute("alt",t),e.setAttribute("class","latex-image"),e.style.verticalAlign="middle",document.getElementById("image-container").innerHTML=e.outerHTML}else if("mathjax-png"==e){let e=MathJax.tex2svg(t).firstElementChild.outerHTML+"";svgToPNG(e,function(e){let a=document.createElement("img");a.src=e,a.setAttribute("alt",t),a.setAttribute("class","latex-image"),a.style.verticalAlign="middle",document.getElementById("image-container").innerHTML=a.outerHTML})}else{let e=asciimath.latexToSVG(t),a="data:image/svg+xml;base64,"+Base64.encode(e),n=document.createElement("img");n.src=a,n.setAttribute("alt",t),n.setAttribute("data-latex",t),n.setAttribute("class","latex-image"),n.style.verticalAlign="middle";let i=n.outerHTML;document.getElementById("image-container").innerHTML=i}else document.getElementById("image-container").innerHTML=""}function decodeLatexFromURI(t){return t.indexOf("#latex%7C")>-1&&(t=t.substring(t.indexOf("#latex%7C")+9),t=decodeURIComponent(t)),t}function contains(t,e){for(let a in t)if(t[a].toLowerCase()==e.toLowerCase())return!0;return!1}function isContetRTF(t){return contains(t,"text/html")||contains(t,"text/rtf")}function handlePasteImage(t){let e="";if(t&&t.clipboardData&&t.clipboardData.getData)if(isContetRTF(t.clipboardData.types)){document.getElementById("renderer").value="mathml-png",e=t.clipboardData.getData("text/plain");try{e=asciimath.reconstructSqrtWord(e),e=asciimath.filterData(e),e=asciimath.reconstructMatrix(e),e=asciimath.reconstructVector(e),t.clipboardData.setData("text/html",e),document.getElementById("latex-input").value=e,renderLatex(e)}catch(t){e=asciimath.reconstructSqrtWord(e),e=asciimath.filterData(e),e=asciimath.reconstructMatrix(e),e=asciimath.reconstructVector(e),renderLatex(e),document.getElementById("latex-input").value=e}t.preventDefault&&(t.stopPropagation(),t.preventDefault())}else e=t.clipboardData.getData("text/plain"),e=asciimath.filterData(e),e=asciimath.reconstructMatrix(e),e=asciimath.reconstructVector(e),setTimeout(function(){""!=e&&(document.getElementById("latex-input").value=e)},10),renderLatex(e)}function insertEquation(t){let e=document.getElementById("latex-input").value,a=document.getElementById("renderer").value;if(""!=e)if("mathjax-svg"==a){let a=MathJax.tex2svg(e).firstElementChild.outerHTML+"",n="data:image/svg+xml;base64,"+Base64.encode(a);t?window.parent.uploadBase64ImageFromLatex(n,2,"svg","latex|"+e):window.parent.uploadBase64ImageFromLatex(n,2,"svg")}else if("mathjax-png"==a){let a=MathJax.tex2svg(e).firstElementChild.outerHTML+"";svgToPNG(a,function(a){t?window.parent.uploadBase64ImageFromLatex(a,2,"png","latex|"+e):window.parent.uploadBase64ImageFromLatex(a,2,"png")})}else if("mathml-svg"==a){let a=asciimath.latexToSVG(e,!0,!0);t?window.parent.uploadBase64ImageFromLatex("data:image/svg+xml;base64,"+Base64.encode(a),2,"svg","latex|"+e):window.parent.uploadBase64ImageFromLatex("data:image/svg+xml;base64,"+Base64.encode(a),2,"svg")}else{let a=asciimath.latexToSVG(e,!0,!0);svgToPNG(a,function(a){t?window.parent.uploadBase64ImageFromLatex(a,2,"png","latex|"+e):window.parent.uploadBase64ImageFromLatex(a,2,"png")})}}function svgToPNG(t,e){let a=window.URL||window.webkitURL||window,n=new Image,i=new Blob([t],{type:"image/svg+xml"}),r=a.createObjectURL(i),c=document.createElement("canvas"),o=c.getContext("2d");n.onload=function(){c.setAttribute("width",n.width),c.setAttribute("height",n.height),o.drawImage(n,0,0),a.revokeObjectURL(r),e(c.toDataURL("png"))},n.src=r}window.onload=function(t){let e="mathjax-svg";document.getElementById("renderer").value=e,document.getElementById("renderer").addEventListener("change",function(t){let e=document.getElementById("latex-input").value;e=asciimath.filterData(e),e=asciimath.reconstructMatrix(e),e=asciimath.reconstructVector(e),renderLatex(e)}),document.getElementById("latex-input").addEventListener("change",function(t){let e=t.target.value;e=asciimath.filterData(e),e=asciimath.reconstructMatrix(e),e=asciimath.reconstructVector(e),renderLatex(e)}),document.getElementById("latex-input").addEventListener("keyup",function(t){let e=t.target.value;e=asciimath.filterData(e),e=asciimath.reconstructMatrix(e),e=asciimath.reconstructVector(e),renderLatex(e)}),document.getElementById("latex-input").addEventListener("blur",function(t){let e=t.target.value;e=asciimath.filterData(e),e=asciimath.reconstructMatrix(e),e=asciimath.reconstructVector(e),renderLatex(e)}),document.getElementById("latex-input").addEventListener("focus",function(t){let e=t.target.value;e=asciimath.filterData(e),e=asciimath.reconstructMatrix(e),e=asciimath.reconstructVector(e),renderLatex(e)}),document.getElementById("latex-input").addEventListener("paste",handlePasteImage);let a=document.location.toString();if(a.indexOf("arg=")>-1){let t=a.substring(a.indexOf("arg=")+4);t=decodeURIComponent(t),t=t.trim(),0===t.indexOf("$$")&&(t=t.substring(2)),"$$"==t.substring(t.length-2,2)&&(t=t.substring(0,t.length-2)),t=decodeLatexFromURI(t),t=asciimath.reconstructSqrtWord(t),t=asciimath.filterData(t),t=asciimath.reconstructMatrix(t),t=asciimath.reconstructVector(t),document.getElementById("latex-input").value=t}document.getElementById("latex-input").focus();let n=document.getElementById("latex-input").value;renderLatex(n)};let generatePNG=!0;