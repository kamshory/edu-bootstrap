function renderLatex(latex){let rendererSelector=document.getElementById("renderer").value;if(""!=latex)if("mathjax-svg"==rendererSelector){let img=document.createElement("img"),data=MathJax.tex2svg(latex).firstElementChild.outerHTML+"",url="data:image/svg+xml;base64,"+Base64.encode(data);img.src=url,img.setAttribute("alt",latex),img.setAttribute("class","latex-image"),img.style.verticalAlign="middle",document.getElementById("image-container").innerHTML=img.outerHTML}else if("mathjax-png"==rendererSelector){let data;svgToPNG(MathJax.tex2svg(latex).firstElementChild.outerHTML+"",(function(base64EncodedURL){let img=document.createElement("img");img.src=base64EncodedURL,img.setAttribute("alt",latex),img.setAttribute("class","latex-image"),img.style.verticalAlign="middle",document.getElementById("image-container").innerHTML=img.outerHTML}))}else{let svg=asciimath.latexToSVG(latex),url="data:image/svg+xml;base64,"+Base64.encode(svg),img=document.createElement("img");img.src=url,img.setAttribute("alt",latex),img.setAttribute("data-latex",latex),img.setAttribute("class","latex-image"),img.style.verticalAlign="middle";let html=img.outerHTML;document.getElementById("image-container").innerHTML=html}else document.getElementById("image-container").innerHTML=""}function decodeLatexFromURI(data){return data.indexOf("#latex%7C")>-1&&(data=data.substring(data.indexOf("#latex%7C")+9),data=decodeURIComponent(data)),data}function contains(arr,text){for(let i in arr)if(arr[i].toLowerCase()==text.toLowerCase())return!0;return!1}function isContetRTF(types){return contains(types,"text/html")||contains(types,"text/rtf")}function handlePasteImage(e){let data="";if(e&&e.clipboardData&&e.clipboardData.getData)if(isContetRTF(e.clipboardData.types)){document.getElementById("renderer").value="mathml-png",data=e.clipboardData.getData("text/plain");try{data=asciimath.reconstructSqrtWord(data),data=asciimath.filterData(data),data=asciimath.reconstructMatrix(data),data=asciimath.reconstructVector(data),e.clipboardData.setData("text/html",data),document.getElementById("latex-input").value=data,renderLatex(data)}catch(e){data=asciimath.reconstructSqrtWord(data),data=asciimath.filterData(data),data=asciimath.reconstructMatrix(data),data=asciimath.reconstructVector(data),renderLatex(data),document.getElementById("latex-input").value=data}e.preventDefault&&(e.stopPropagation(),e.preventDefault())}else data=e.clipboardData.getData("text/plain"),data=asciimath.filterData(data),data=asciimath.reconstructMatrix(data),data=asciimath.reconstructVector(data),setTimeout((function(){""!=data&&(document.getElementById("latex-input").value=data)}),10),renderLatex(data)}window.onload=function(e){let equgen="mathjax-svg";document.getElementById("renderer").value=equgen,document.getElementById("renderer").addEventListener("change",(function(e){let data=document.getElementById("latex-input").value;data=asciimath.filterData(data),data=asciimath.reconstructMatrix(data),data=asciimath.reconstructVector(data),renderLatex(data)})),document.getElementById("latex-input").addEventListener("change",(function(e){let data=e.target.value;data=asciimath.filterData(data),data=asciimath.reconstructMatrix(data),data=asciimath.reconstructVector(data),renderLatex(data)})),document.getElementById("latex-input").addEventListener("keyup",(function(e){let data=e.target.value;data=asciimath.filterData(data),data=asciimath.reconstructMatrix(data),data=asciimath.reconstructVector(data),renderLatex(data)})),document.getElementById("latex-input").addEventListener("blur",(function(e){let data=e.target.value;data=asciimath.filterData(data),data=asciimath.reconstructMatrix(data),data=asciimath.reconstructVector(data),renderLatex(data)})),document.getElementById("latex-input").addEventListener("focus",(function(e){let data=e.target.value;data=asciimath.filterData(data),data=asciimath.reconstructMatrix(data),data=asciimath.reconstructVector(data),renderLatex(data)})),document.getElementById("latex-input").addEventListener("paste",handlePasteImage);let url=document.location.toString(),data;if(url.indexOf("arg=")>-1){let textSelected=url.substring(url.indexOf("arg=")+4);textSelected=decodeURIComponent(textSelected),textSelected=textSelected.trim(),0===textSelected.indexOf("$$")&&(textSelected=textSelected.substring(2)),"$$"==textSelected.substring(textSelected.length-2,2)&&(textSelected=textSelected.substring(0,textSelected.length-2)),textSelected=decodeLatexFromURI(textSelected),textSelected=asciimath.reconstructSqrtWord(textSelected),textSelected=asciimath.filterData(textSelected),textSelected=asciimath.reconstructMatrix(textSelected),textSelected=asciimath.reconstructVector(textSelected),document.getElementById("latex-input").value=textSelected}document.getElementById("latex-input").focus(),renderLatex(document.getElementById("latex-input").value)};let generatePNG=!0;function insertEquation(includeLatex){let latex=document.getElementById("latex-input").value,rendererSelector=document.getElementById("renderer").value;if(""!=latex)if("mathjax-svg"==rendererSelector){let data=MathJax.tex2svg(latex).firstElementChild.outerHTML+"",url="data:image/svg+xml;base64,"+Base64.encode(data);includeLatex?window.parent.uploadBase64ImageFromLatex(url,2,"svg","latex|"+latex):window.parent.uploadBase64ImageFromLatex(url,2,"svg")}else if("mathjax-png"==rendererSelector){let data;svgToPNG(MathJax.tex2svg(latex).firstElementChild.outerHTML+"",(function(base64EncodedURL){includeLatex?window.parent.uploadBase64ImageFromLatex(base64EncodedURL,2,"png","latex|"+latex):window.parent.uploadBase64ImageFromLatex(base64EncodedURL,2,"png")}))}else if("mathml-svg"==rendererSelector){let data=asciimath.latexToSVG(latex,!0,!0);includeLatex?window.parent.uploadBase64ImageFromLatex("data:image/svg+xml;base64,"+Base64.encode(data),2,"svg","latex|"+latex):window.parent.uploadBase64ImageFromLatex("data:image/svg+xml;base64,"+Base64.encode(data),2,"svg")}else{let data;svgToPNG(asciimath.latexToSVG(latex,!0,!0),(function(base64EncodedURL){includeLatex?window.parent.uploadBase64ImageFromLatex(base64EncodedURL,2,"png","latex|"+latex):window.parent.uploadBase64ImageFromLatex(base64EncodedURL,2,"png")}))}}function svgToPNG(svgData,onloadCallback){let DOMURL=window.URL||window.webkitURL||window,img=new Image,svg=new Blob([svgData],{type:"image/svg+xml"}),url=DOMURL.createObjectURL(svg),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");img.onload=function(){canvas.setAttribute("width",img.width),canvas.setAttribute("height",img.height),ctx.drawImage(img,0,0),DOMURL.revokeObjectURL(url),onloadCallback(canvas.toDataURL("png"))},img.src=url}