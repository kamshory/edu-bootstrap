function fixWidth(t){var a=85/($(t).find("thead").find("tr").find("td").length-1);$(t).find("thead").find("tr").find("td").css({width:a+"%"}),$(t).find("thead").find("tr").find("td:first-child").css({width:"15%"})}function addSeries(t){var a=$(t).find("thead").find("tr").find("td").length;$(t).find("thead").find("tr").append('<td><input name="series" type="text" autocomplete="off" value="Series '+a+'"></td>'),$(t).find("tbody").find("tr").each(function(t,a){$(this).append('<td><input name="value" type="text" autocomplete="off" value="0"></td>')}),fixWidth(t)}function subtractSeries(t){$(t).find("thead").find("tr").find("td").length>2&&($(t).find("thead").find("tr").find("td:last-child").remove(),$(t).find("tbody").find("tr").each(function(t,a){$(this).find("td:last-child").remove()})),fixWidth(t)}function addRows(t){var a,e=$(t).find("tbody").find("tr").length,i=$(t).find("thead").find("tr").find("td").length,n=$("<tr>");for(n.append('<td><input name="time" type="text" autocomplete="off" value="Time '+(e+1)+'"></td>'),a=1;a<i;a++)n.append('<td><input name="value" type="text" autocomplete="off" value="0"></td>');$(t).find("tbody").append(n)}function subtractRows(t){$(t).find("tbody").find("tr").length>1&&$(t).find("tbody").find("tr:last-child").remove()}function renderData(t,a,e,i,n,r){if(enableRender){chartData=buildData(t,a,e,i,n,r),config.options.title.text=chartData.title;var d;config.type=chartData.type,config.size=chartData.size,config.type||(config.type="line"),config.size||(config.size="500"),config.data.labels=chartData.labels,config.options.scales.xAxes[0].scaleLabel.labelString=chartData.axesX,config.options.scales.yAxes[0].scaleLabel.labelString=chartData.axesY,config.data.datasets=[];for(d in chartData.datasets)config.data.datasets[d]={},config.data.datasets[d].label=chartData.datasets[d].label,config.data.datasets[d].data=chartData.datasets[d].data,config.data.datasets[d].fill=!1,config.data.datasets[d].backgroundColor=window.chartColorsArray[d%window.chartColorsArray.length],config.data.datasets[d].borderColor=window.chartColorsArray[d%window.chartColorsArray.length];canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),(chartObject=new Chart(ctx,config)).update()}enableRender=!1,clearTimeout(timeout),timeout=setTimeout(function(){enableRender=!0},200)}function buildData(t,a,e,i,n,r){var d={};d.type=$(t).val().trim(),d.size=$(a).val().trim(),d.title=$(e).val().trim(),d.title=$(e).val().trim(),d.axesX=$(i).val().trim(),d.axesY=$(n).val().trim(),d.labels=[],d.datasets=[],d.type||(d.type="line"),d.size||(d.type="500"),$(r).find("tbody").find("tr").each(function(t,a){d.labels[d.labels.length]=$(this).find("td:first-child").find("input").val().trim()});var s,l,o=$(r).find("thead").find("tr").find("td").length,c=$(r).find("tbody").find("tr").length;for(s=2;s<=o;s++){var f=[];for(l=1;l<=c;l++)f[f.length]=parseFloat($(r).find("tbody").find("tr:nth-child("+l+")").find("td:nth-child("+s+")").find("input").val().trim());d.datasets[d.datasets.length]={label:$(r).find("thead").find("tr").find("td:nth-child("+s+")").find("input").val().trim(),data:f}}return d}function restoreData(t,a,e,i,n,r,d){t.type||(t.type="line"),t.size||(t.size="500"),$(a).val(t.type),$(e).val(t.size),$(i).val(t.title),$(n).val(t.axesX),$(r).val(t.axesY);var s=t.datasets.length,l=t.labels.length;subtractRows(d),subtractRows(d),subtractRows(d),subtractSeries(d),subtractSeries(d),subtractSeries(d);var o,c,f,h;for(o=1;o<s;o++)addSeries(d);for(o=1;o<l;o++)addRows(d);for(o=0,c=2;o<s;o++,c++)$(d).find("thead").find("tr").find("td:nth-child("+c+")").find("input").val(t.datasets[o].label);for(o=0,c=2;o<s;o++,c++)for(f=0,h=1;f<l;f++,h++)$(d).find("tbody").find("tr:nth-child("+h+")").find("td:nth-child("+c+")").find("input").val(t.datasets[o].data[f]);for(f=0,h=1;f<l;f++,h++)$(d).find("tbody").find("tr:nth-child("+h+")").find("td:first-child").find("input").val(t.labels[f])}tinyMCEPopup.requireLangPack();var ChartDialog={init:function(){document.forms[0];var t=tinyMCEPopup.editor,a=t.dom,e=t.selection.getNode(),i=decodeURIComponent(a.getAttrib(e,"data-chart"))||"";if(fixWidth("#main-table"),""!=i){var n=JSON.parse(i);restoreData(n,"#type","#size","#chart-title","#axes-x","#axes-y","#main-table");var r=parseInt(n.size),d=parseInt(.6*r);$("#size").val(r),$("#canvas-container, #canvas").width(r),$("#canvas").height(d),$("#canvas").attr("width",r),$("#canvas").attr("height",d)}renderData("#type","#size","#chart-title","#axes-x","#axes-y","#main-table")},insert:function(){var t="";mcTabs.displayTab("chart_tab","chart_panel"),renderData("#type","#size","#chart-title","#axes-x","#axes-y","#main-table"),setTimeout(function(){var a=canvas.toDataURL(),e=document.createElement("img");e.setAttribute("src",a),e.setAttribute("class","chart-image"),e.setAttribute("data-chart",JSON.stringify(chartData)),e.style.maxWidth="100%",e.style.height="auto",t=e.outerHTML,tinyMCEPopup.editor.execCommand("mceInsertRawHTML",!1,t),tinyMCEPopup.close()},100)}};window.chartColors={red:"rgb(255, 99, 132)",orange:"rgb(255, 159, 64)",green:"rgb(75, 192, 192)",blue:"rgb(54, 162, 235)",purple:"rgb(153, 102, 255)",grey:"rgb(201, 203, 207)",yellow:"rgb(255, 205, 86)",brown:"rgb(168, 43, 43)",pink:"rgb(255, 73, 182)",cadetblue:"rgb(96, 160, 162)"},window.chartColorsArray=["rgb(255, 99, 132)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(54, 162, 235)","rgb(153, 102, 255)","rgb(201, 203, 207)","rgb(255, 159, 64)","rgb(168, 43, 43)","rgb(255, 73, 182)","rgb(96, 160, 162)"];var chartData={};$(document).ready(function(t){$(document).on("click","#add-series",function(t){addSeries("#main-table"),renderData("#type","#type","#chart-title","#axes-x","#axes-y","#main-table")}),$(document).on("click","#subtract-series",function(t){subtractSeries("#main-table"),renderData("#type","#size","#chart-title","#axes-x","#axes-y","#main-table")}),$(document).on("click","#add-rows",function(t){addRows("#main-table"),renderData("#type","#size","#chart-title","#axes-x","#axes-y","#main-table")}),$(document).on("click","#subtract-rows",function(t){subtractRows("#main-table"),renderData("#type","#size","#chart-title","#axes-x","#axes-y","#main-table")}),$(document).on("click","#build",function(t){renderData("#type","#size","#chart-title","#axes-x","#axes-y","#main-table")}),$(document).on("change","#type, input",function(t){chartData=buildData("#type","#size","#chart-title","#axes-x","#axes-y","#main-table"),renderData("#type","#size","#chart-title","#axes-x","#axes-y","#main-table")}),$(document).on("change","#size",function(t){var a=parseInt($(this).val()),e=parseInt(.6*a);$("#canvas-container, #canvas").width(a),$("#canvas").height(e),$("#canvas").attr("width",a),$("#canvas").attr("height",e),chartData=buildData("#type","#size","#chart-title","#axes-x","#axes-y","#main-table"),renderData("#type","#size","#chart-title","#axes-x","#axes-y","#main-table")})});var canvas,ctx,chartObject,enableRender=!0,timeout=setTimeout(function(){},1e3),config={type:"line",data:{labels:[],datasets:[]},options:{responsive:!0,title:{display:!0},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Time"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Value"}}]},ticks:{min:0},animation:{duration:10,easing:"linear"}}};tinyMCEPopup.onInit.add(ChartDialog.init,ChartDialog);