function getNumberingType(opt1,opt2){let o1=opt1.split(".")[0].trim(),o2=opt2.split(".")[0].trim(),numbering;return numbering="A"==o1&&"B"==o2?"upper-alpha":"a"==o1&&"b"==o2?"lower-alpha":"I"==o1&&"II"==o2?"upper-roman":"i"==o1&&"ii"==o2?"lower-roman":"1"==o1&&"2"==o2?"decimal":"01"==o1&&"02"==o2?"decimal-leading-zero":"upper-alpha",numbering}"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),String.prototype.replaceAll=function(str1,str2,ignore){return this.replace(new RegExp(str1.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),ignore?"gi":"g"),"string"==typeof str2?str2.replace(/\$/g,"$$$$"):str2)},String.prototype.trimMask=function(mask){let s=this.trim();for(;~mask.indexOf(s[0]);)s=s.slice(1);for(;~mask.indexOf(s[s.length-1]);)s=s.slice(0,-1);return s=s.trim(),s=s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),s},String.prototype.countSubstring=function(subText){let arr;return this.split(subText).length-1},String.prototype.escapeHTML=function(repAll){return void 0===repAll?this.replace(/<br \/>/g,"\n").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br />"):this.replace(/<br \/>/g,"\n").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"&lt;br /&gt;")},String.prototype.restoreBR=function(){return this.replace(/&lt;br \/&gt;/g," <br />")},String.prototype.escapeHTMLEntities=function(){return escapeHtmlEntities(this)},"undefined"==typeof escapeHtmlEntities&&(escapeHtmlEntities=function(text){return text.replace(/[\u00A0-\u2666<>\&]/g,(function(c){return"&"+(escapeHtmlEntities.entityTable[c.charCodeAt(0)]||"#"+c.charCodeAt(0))+";"}))},escapeHtmlEntities.entityTable={34:"quot",38:"amp",39:"apos",60:"lt",62:"gt",160:"nbsp",161:"iexcl",162:"cent",163:"pound",164:"curren",165:"yen",166:"brvbar",167:"sect",168:"uml",169:"copy",170:"ordf",171:"laquo",172:"not",173:"shy",174:"reg",175:"macr",176:"deg",177:"plusmn",178:"sup2",179:"sup3",180:"acute",181:"micro",182:"para",183:"middot",184:"cedil",185:"sup1",186:"ordm",187:"raquo",188:"frac14",189:"frac12",190:"frac34",191:"iquest",192:"Agrave",193:"Aacute",194:"Acirc",195:"Atilde",196:"Auml",197:"Aring",198:"AElig",199:"Ccedil",200:"Egrave",201:"Eacute",202:"Ecirc",203:"Euml",204:"Igrave",205:"Iacute",206:"Icirc",207:"Iuml",208:"ETH",209:"Ntilde",210:"Ograve",211:"Oacute",212:"Ocirc",213:"Otilde",214:"Ouml",215:"times",216:"Oslash",217:"Ugrave",218:"Uacute",219:"Ucirc",220:"Uuml",221:"Yacute",222:"THORN",223:"szlig",224:"agrave",225:"aacute",226:"acirc",227:"atilde",228:"auml",229:"aring",230:"aelig",231:"ccedil",232:"egrave",233:"eacute",234:"ecirc",235:"euml",236:"igrave",237:"iacute",238:"icirc",239:"iuml",240:"eth",241:"ntilde",242:"ograve",243:"oacute",244:"ocirc",245:"otilde",246:"ouml",247:"divide",248:"oslash",249:"ugrave",250:"uacute",251:"ucirc",252:"uuml",253:"yacute",254:"thorn",255:"yuml",402:"fnof",913:"Alpha",914:"Beta",915:"Gamma",916:"Delta",917:"Epsilon",918:"Zeta",919:"Eta",920:"Theta",921:"Iota",922:"Kappa",923:"Lambda",924:"Mu",925:"Nu",926:"Xi",927:"Omicron",928:"Pi",929:"Rho",931:"Sigma",932:"Tau",933:"Upsilon",934:"Phi",935:"Chi",936:"Psi",937:"Omega",945:"alpha",946:"beta",947:"gamma",948:"delta",949:"epsilon",950:"zeta",951:"eta",952:"theta",953:"iota",954:"kappa",955:"lambda",956:"mu",957:"nu",958:"xi",959:"omicron",960:"pi",961:"rho",962:"sigmaf",963:"sigma",964:"tau",965:"upsilon",966:"phi",967:"chi",968:"psi",969:"omega",977:"thetasym",978:"upsih",982:"piv",8226:"bull",8230:"hellip",8242:"prime",8243:"Prime",8254:"oline",8260:"frasl",8472:"weierp",8465:"image",8476:"real",8482:"trade",8501:"alefsym",8592:"larr",8593:"uarr",8594:"rarr",8595:"darr",8596:"harr",8629:"crarr",8656:"lArr",8657:"uArr",8658:"rArr",8659:"dArr",8660:"hArr",8704:"forall",8706:"part",8707:"exist",8709:"empty",8711:"nabla",8712:"isin",8713:"notin",8715:"ni",8719:"prod",8721:"sum",8722:"minus",8727:"lowast",8730:"radic",8733:"prop",8734:"infin",8736:"ang",8743:"and",8744:"or",8745:"cap",8746:"cup",8747:"int",8756:"there4",8764:"sim",8773:"cong",8776:"asymp",8800:"ne",8801:"equiv",8804:"le",8805:"ge",8834:"sub",8835:"sup",8836:"nsub",8838:"sube",8839:"supe",8853:"oplus",8855:"otimes",8869:"perp",8901:"sdot",8968:"lceil",8969:"rceil",8970:"lfloor",8971:"rfloor",9001:"lang",9002:"rang",9674:"loz",9824:"spades",9827:"clubs",9829:"hearts",9830:"diams",338:"OElig",339:"oelig",352:"Scaron",353:"scaron",376:"Yuml",710:"circ",732:"tilde",8194:"ensp",8195:"emsp",8201:"thinsp",8204:"zwnj",8205:"zwj",8206:"lrm",8207:"rlm",8211:"ndash",8212:"mdash",8216:"lsquo",8217:"rsquo",8218:"sbquo",8220:"ldquo",8221:"rdquo",8222:"bdquo",8224:"dagger",8225:"Dagger",8240:"permil",8249:"lsaquo",8250:"rsaquo",8364:"euro"}),String.prototype.splitWithLimit=function(separator,limit){let value=this,pattern,startIndex,m;value=value.toString();let parts=[];if(!limit)return value.split(separator);pattern=separator instanceof RegExp?new RegExp(separator.source,"g"+(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")):new RegExp(separator.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1"),"g");do{startIndex=pattern.lastIndex,m=pattern.exec(value),m&&parts.push(value.length<m.index-startIndex?value:value.substring(startIndex,m.index-startIndex))}while(m&&parts.length<limit-1);return parts.push(value.substring(pattern.lastIndex)),parts};let numberingList={"upper-alpha":["A","B","C","D","E","F","G","H","I","J"],"lower-alpha":["a","b","c","d","e","f","g","h","i","j"],"upper-roman":["I","II","III","IV","V","VI","VII","VIII","IX","X"],"lower-roman":["i","ii","iii","iv","v","vi","vii","vii","ix","x"],decimal:["1","2","3","4","5","6","7","8","9","10"],"decimal-leading-zero":["01","02","03","04","05","06","07","08","09","10"]};function optionMatch(opt,numbering){let num=numberingList[numbering];return void 0===num?-1:num.indexOf(opt)}function parseQuestion(input){let i,k,input1,input2,question,options=[],numbering="",opt="",tmp=[];for(i in tmp=input.split("\n"),tmp)tmp[i]=tmp[i].trimMask(" \r\n\t ");input=tmp.join("\n"),tmp=[],input1=input,input2=input1.replaceAll("\\\\\n","<br />");let lines=input2.split("\n");if(lines.length>=3){for(i in question=lines[0],lines)lines[i]=lines[i].trimMask(" \r\n\t ");i=1;do{if(numbering=getNumberingType(lines[i],lines[i+1]),i++,i>=lines.length-2)break}while(""==numbering);for(i=1,k=-1;i<lines.length-1;i++)lines[i].indexOf(".")>-1?(tmp=lines[i].splitWithLimit(".",2),opt=tmp[0].trimMask(" \r\n\t "),optionMatch(opt,numbering)>-1?(options.push({text:tmp[1].trimMask(" \r\n\t "),score:0}),k++):-1==k?question+="<br />"+lines[i]:options[k].text+="<br />"+lines[i]):-1==k?question+="<br />"+lines[i]:options[k].text+="<br />"+lines[i];if(lines.length>3){let lastIsAnswer=!0;if(lines[lines.length-1].countSubstring(":")==lines[lines.length-1].countSubstring("\\\\:")&&(lastIsAnswer=!1),lines[lines.length-1].indexOf(":")>-1&&lastIsAnswer){lines[lines.length-1]=lines[lines.length-1].replaceAll("\t"," "),tmp=lines[lines.length-1].splitWithLimit(":",2),opt=tmp[1].trimMask(" \r\n\t "),opt=opt.split(" ")[0].trimMask(" \r\n\t ");let answerIndex=optionMatch(opt,numbering);answerIndex>-1&&answerIndex<options.length?options[answerIndex].score=1:(tmp=lines[lines.length-1].splitWithLimit(".",2),opt=tmp[0].trimMask(" \r\n\t "),optionMatch(opt,numbering)>-1&&options.push({text:tmp[1].trimMask(" \r\n\t "),score:0}))}else lines[lines.length-1].indexOf(".")>-1&&(tmp=lines[lines.length-1].splitWithLimit(".",2),opt=tmp[0].trimMask(" \r\n\t "),optionMatch(opt,numbering)>-1&&options.push({text:tmp[1].trimMask(" \r\n\t "),score:0}))}}else options=[],numbering="upper-alpha",question=lines[0];for(i in question.replaceAll("\\\\:",":"),options)options[i].text=options[i].text.replaceAll("\\\\:",":");return{question:question,options:options,numbering:numbering}}function buldOptionHTML(question,parseImg,baseIMGURL){let i,j;parseImg=parseImg||!1,baseIMGURL=baseIMGURL||"";let html="",score="";for(i in void 0===question.numbering&&(question.numbering="upper-alpha"),html+='\r\n\t<ol class="option-ol" start="'+numberingList[question.numbering][0]+'" style="list-style-type:'+question.numbering+'">',question.options)j=question.options[i],score=j.score>0?'<span class="score"></span>':"",html+='\r\n\t\t<li class="option-li">'+score+"<span>"+j.text.escapeHTMLEntities().restoreBR().addImage(parseImg,baseIMGURL)+"</span></li>";return html+="\r\n\t</ol>",html}function buildQuestionHTML(inObj,parseImg,baseIMGURL){let i;parseImg=parseImg||!1,baseIMGURL=baseIMGURL||"";let html="";if(null!=inObj&&inObj.length>0){for(i in html+='\r\n<ol class="question-ol">',inObj)html+="\r\n\t<li><span>"+inObj[i].question.escapeHTMLEntities().restoreBR().addImage(parseImg,baseIMGURL)+"</span>"+buldOptionHTML(inObj[i],parseImg,baseIMGURL)+"\r\n\t</li>";html+="\r\n</ol>"}return html}function buildQuestion(input){let input1,input2,question;for(input1=input.toString(),input2=input1.replaceAll("\r\n","\n");input2.indexOf("\n\n\n")>-1;)input2=input2.replaceAll("\n\n\n","\n\n");if(input2=input2.trimMask(" \r\n\t "),input2.length>0){let questions=input2.split("\n\n"),retObj=[];for(let i in questions)question=questions[i].trimMask(" \r\n\t "),""!=question&&retObj.push(parseQuestion(question));return retObj}return null}function getYouTubeParams(url){let videoid=(url=url.toString()).match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/);return null!=videoid?{video_id:videoid[1],url:url}:null}let verticalAlign=["baseline","top","bottom","middle","text-top","text-bottom"];function getInputSelection(el){let start=0,end=0,normalizedValue,range,textInputRange,len,endRange;return"number"==typeof el.selectionStart&&"number"==typeof el.selectionEnd?(start=el.selectionStart,end=el.selectionEnd):(range=document.selection.createRange(),range&&range.parentElement()==el&&(len=el.value.length,normalizedValue=el.value.replace(/\r\n/g,"\n"),textInputRange=el.createTextRange(),textInputRange.moveToBookmark(range.getBookmark()),endRange=el.createTextRange(),endRange.collapse(!1),textInputRange.compareEndPoints("StartToEnd",endRange)>-1?start=end=len:(start=-textInputRange.moveStart("character",-len),start+=normalizedValue.slice(0,start).split("\n").length-1,textInputRange.compareEndPoints("EndToEnd",endRange)>-1?end=len:(end=-textInputRange.moveEnd("character",-len),end+=normalizedValue.slice(0,end).split("\n").length-1)))),{start:start,end:end}}function noAnswer(questions){let i,j,k,m=[],score;if(null!=questions)for(i in questions){for(k in j=questions[i].options,score=0,j)score+=j[k].score;0==score&&m.push(parseInt(i)+1)}return m}function inputChanged(e){let elemInput,elemOutput,elemStatus;renderQuestion(e.target,document.getElementById("preview2"),document.getElementById("status"))}function renderQuestion(elemInput,elemOutput,elemStatus){let input,out=elemOutput,questions=buildQuestion(elemInput.value);out.innerHTML=buildQuestionHTML(questions,parseImg,baseIMGURL),$("#preview2 > ol > li:first-child").attr("value",startFrom);let noAnswerQuestion=noAnswer(questions);if(null==questions)elemStatus.innerHTML="";else{let nQuestion=questions.length;if(modContinue){let i;for(i=0;i<noAnswerQuestion.length;i++)noAnswerQuestion[i]+=startFrom-1;nQuestion+=startFrom-1}let status="";status="Jumlah soal: "+nQuestion,noAnswerQuestion.length&&(status+=" | Tanpa jawaban: Nomor "+noAnswerQuestion.join(", ")),elemStatus.innerHTML=status}}String.prototype.addImage=function(image,base){let str=this;if(base=base||"",!image)return this;{let i,j,k,l,m,n,txt,file,imghtml,pos,base2,arrayX=str.match(/(?:^|)img:([a-zA-Z\S]+)/gi);for(i in arrayX)txt=arrayX[i].trimMask(" \r\n\t "),pos=txt.indexOf("img:"),file=txt.substr(pos+4),k="",file.indexOf("#")>-1&&(j=file.split("#"),file=j[0],$.inArray(j[1],verticalAlign)>-1&&(k+=' style="vertical-align:'+j[1]+'"'),j.length>2&&(l=j[2].split(","),m=parseInt(l[0]||"0"),n=parseInt(l[1]||"0"),m>0&&(k+=' width="'+m+'"'),n>0&&(k+=' height="'+n+'"'))),base2=-1!=file.indexOf("://")?"":base,imghtml='<img src="'+base2+file+'"'+k+">",str=str.replace(txt,imghtml);for(i in arrayX=str.match(/(?:^|)audio:([a-zA-Z\S]+)/gi),arrayX)txt=arrayX[i].trimMask(" \r\n\t "),pos=txt.indexOf("audio:"),file=txt.substr(pos+6),k="",file.indexOf("#")>-1?(j=file.split("#"),file=j[0],$.inArray(j[1],verticalAlign)>-1&&(k+=' style="vertical-align:'+j[1]+'"'),j.length>2?(l=j[2].split(","),m=parseInt(l[0]||"0"),n=parseInt(l[1]||"0"),k+=m>0?' width="'+m+'"':' width="300"',k+=n>0?' height="'+n+'"':' height="50"'):k+=' width="300" height="50"'):k+=' width="300" height="40"',base2=-1!=file.indexOf("://")?"":base,base2=-1!=file.indexOf("://")?"":base,imghtml='<audio src="'+base2+file+'"'+k+" controls></audio>",str=str.replace(txt,imghtml);for(i in arrayX=str.match(/(?:^|)video:([a-zA-Z\S]+)/gi),arrayX)txt=arrayX[i].trimMask(" \r\n\t "),pos=txt.indexOf("video:"),file=txt.substr(pos+6),k="",file.indexOf("#")>-1?(j=file.split("#"),file=j[0],$.inArray(j[1],verticalAlign)>-1&&(k+=' style="vertical-align:'+j[1]+'"'),j.length>2?(l=j[2].split(","),m=parseInt(l[0]||"0"),n=parseInt(l[1]||"0"),k+=m>0?' width="'+m+'"':' width="500"',k+=n>0?' height="'+n+'"':' height="280"'):k+=' width="500" height="280"'):k+=' width="500" height="280"',base2=-1!=file.indexOf("://")?"":base,base2=-1!=file.indexOf("://")?"":base,imghtml='<video src="'+base2+file+'"'+k+" controls></video>",str=str.replace(txt,imghtml);for(i in arrayX=str.match(/(?:^|)iframe:([a-zA-Z\S]+)/gi),arrayX)txt=arrayX[i].trimMask(" \r\n\t "),pos=txt.indexOf("iframe:"),file=txt.substr(pos+7),k="",file.indexOf("#")>-1?(j=file.split("#"),file=j[0],$.inArray(j[1],verticalAlign)>-1&&(k+=' style="vertical-align:'+j[1]+'"'),j.length>2?(l=j[2].split(","),m=parseInt(l[0]||"0"),n=parseInt(l[1]||"0"),k+=m>0?' width="'+m+'"':' width="500"',k+=n>0?' height="'+n+'"':' height="280"'):k+=' width="500" height="280"'):k+=' width="500" height="280"',base2=-1!=file.indexOf("://")?"":base,base2=-1!=file.indexOf("://")?"":base,imghtml='<iframe src="'+base2+file+'"'+k+' allowfullscreen="allowfullscreen" frameborder="0"></iframe>',str=str.replace(txt,imghtml);for(i in arrayX=str.match(/(?:^|)youtube:([a-zA-Z\S]+)/gi),arrayX){txt=arrayX[i].trimMask(" \r\n\t "),pos=txt.indexOf("img:"),file=txt.substr(pos+4),k="",file.indexOf("#")>-1&&(j=file.split("#"),file=j[0],$.inArray(j[1],verticalAlign)>-1&&(k+=' style="vertical-align:'+j[1]+'"')),base2=-1!=file.indexOf("://")?"":base;let style_element=k,yt,time=0,video_id;imghtml='<iframe type="text/html" marginwidth="0" marginheight="0" scrolling="no" src="https://www.youtube.com/embed/'+getYouTubeParams(file).video_id+"?html5=1&playsinline=1&allowfullscreen=true&rel=0&version=3&autoplay=0&start="+time+'" allowfullscreen="" height="281" width="500"'+style_element+' frameborder="0"></iframe>',str=str.replace(txt,imghtml)}arrayX=str.split("$$");let txtTrimmed="";for(i=1;i<arrayX.length;i+=2)txt=arrayX[i],txtTrimmed=txt.trimMask(" \r\n\t "),txtTrimmed.length?(imghtml='<img src="../cgi-bin/equgen.cgi?'+txt+'" style="vertical-align:middle" data-latex="'+txt+'" alt="'+txt+'">',str=str.replace("$$"+txt+"$$",imghtml)):str=str.replace("$$"+txt+"$$","")}return str};let contentModified=!1,currentFileName="",fileNameList=[];function saveFileData(name,value){let fls=window.localStorage.getItem("filelist")||"[]";fileNameList=eval(fls),-1==fileNameList.indexOf(currentFileName)&&fileNameList.push(currentFileName),window.localStorage.setItem("filelist",JSON.stringify(fileNameList)),window.localStorage.setItem("data_"+name,value),contentModified=!1}function loadFileData(name){let value=window.localStorage.getItem("data_"+name)||"";document.getElementById("input").value=value,document.getElementById("input").focus(),contentModified=!1}function writeFile(){let filename=document.getElementById("filename").value;if(filename=filename.trim(),filename=filename.replace(/[^0-9A-Za-z_\-\(\)]/gi," "),filename=filename.replace(/ {1,}/g," ").trim(),""==filename)alert("Silakan masukkan nama file"),document.getElementById("filename").select();else{currentFileName=filename;let value=document.getElementById("input").value;saveFileData(currentFileName,value),closeDialogFile()}}function selectFileList(name){document.getElementById("filename").value=name}function showEquationDialog(){let html='<div class="file-dialog" style="width:800px">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeEquationDialog();"><span></span></a><span id="file-dialog-title-label">Masukkan Persamaan</span></div>\r\n    <div id="equation-area" style="position:relative; height:480px; overflow:hidden;">\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true"),$("#equation-area").html('<iframe src="equation.html" frameborder="0" style="padding:0;margin:0;width:100%;height:500px;"></iframe>')}function showChemistryDialog(){let html='<div class="file-dialog" style="width:800px">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeChemistryDialog();"><span></span></a><span id="file-dialog-title-label">Editor Molekul</span></div>\r\n    <div id="kekule-area" style="position:relative; height:480px; overflow:hidden;">\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true"),$("#kekule-area").html('<iframe src="chem-editor.html" frameborder="0" style="padding:0;margin:0;width:100%;height:500px;"></iframe>')}function showLatexDialog(){let inputElement=$("#input")[0],selectedText=getInputSelection(inputElement),textValue=inputElement.value,start=selectedText.start,end=selectedText.end,textSelected=textValue.substr(start,end-start);textSelected=textSelected.trim();let html='<div class="file-dialog" style="width:640px">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeEquationDialog();"><span></span></a><span id="file-dialog-title-label">Masukkan Persamaan</span></div>\r\n    <div id="equation-area" style="position:relative; height:352px; overflow:hidden;">\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true");let url="latex.html#arg="+encodeURIComponent(textSelected);$("#equation-area").html('<iframe src="'+url+'" frameborder="0" style="padding:0;margin:0;width:100%;height:400px;"></iframe>')}function showSuperscriptDialog(){let html='<div class="file-dialog" style="width:680px">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeEquationDialog();"><span></span></a><span id="file-dialog-title-label">Masukkan Superscript</span></div>\r\n    <div id="equation-area" style="position:relative; height:372px; overflow:hidden;">\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true"),$("#equation-area").html('<iframe src="superscript.html" frameborder="0" style="padding:0;margin:0;width:100%;height:400px;"></iframe>')}function showSubscriptDialog(){let html='<div class="file-dialog" style="width:680px">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeEquationDialog();"><span></span></a><span id="file-dialog-title-label">Masukkan Subscript</span></div>\r\n    <div id="equation-area" style="position:relative; height:372px; overflow:hidden;">\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true"),$("#equation-area").html('<iframe src="subscript.html" frameborder="0" style="padding:0;margin:0;width:100%;height:400px;"></iframe>')}function showSubSuperscriptDialog(){let html='<div class="file-dialog" style="width:600px">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeEquationDialog();"><span></span></a><span id="file-dialog-title-label">Masukkan Subscript &amp; Superscript</span></div>\r\n    <div id="equation-area" style="position:relative; height:278px; overflow:hidden;">\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true"),$("#equation-area").html('<iframe src="subsuperscript.html" frameborder="0" style="padding:0;margin:0;width:100%;height:306px;"></iframe>')}function showSymbolDialog(){let html='<div class="file-dialog" style="width:680px">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeEquationDialog();"><span></span></a><span id="file-dialog-title-label">Masukkan Simbol</span></div>\r\n    <div id="equation-area" style="position:relative; height:372px; overflow:hidden;">\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true"),$("#equation-area").html('<iframe src="symbol.html" frameborder="0" style="padding:0;margin:0;width:100%;height:400px;"></iframe>')}function insertEquation(latex){let elemInput,elemOutput,elemStatus;insertAtCursor(document.getElementById("input"),latex),renderQuestion(document.getElementById("input"),document.getElementById("preview2"),document.getElementById("status")),closeEquationDialog()}function closeEquationDialog(){let el=document.getElementById("dialog-area");el.setAttribute("data-dialog-shown","false"),setTimeout((function(){el.innerHTML=""}),200)}function closeChemistryDialog(){closeEquationDialog()}function deleteFileFromStorage(){let filename=document.getElementById("filename").value;pbDialog({modal:!0,width:360,height:190,title:"Konfirmasi",content:"<p>Apakah Anda akan menghapus ujian ini?</p>",buttons:{Ya:function(){let i;filename=filename.trim(),filename=filename.replace(/[^0-9A-Za-z_\-\(\)]/gi," "),filename=filename.replace(/ {1,}/g," ").trim();let fls=window.localStorage.getItem("filelist")||"[]";"[null]"==fls&&(fls="[]"),fileNameList=eval(fls);let fls2=[];for(i in fileNameList)fileNameList[i]!=filename&&fls2.push(fileNameList[i]);window.localStorage.removeItem("data_"+filename),window.localStorage.setItem("filelist",JSON.stringify(fls2));let html="<ul>";for(i in fls2)html+="<li><a href=\"javascript:selectFileList('"+fls2[i]+"')\">"+fls2[i]+"</a></li>\r\n";html+="</ul>",document.getElementById("file-dialog-list").innerHTML=html,document.getElementById("filename").value="",closeDialog()},Tidak:function(){closeDialog()}}})}function deleteFile(){showDialogDeleteFile();let fls=window.localStorage.getItem("filelist")||"[]",i;fileNameList=eval(fls);let html="<ul>";for(i in fileNameList)html+='<li class="file-item"><a href="javascript:selectFileList(\''+fileNameList[i]+"')\">"+fileNameList[i]+"</a></li>\r\n";html+="</ul>",document.getElementById("file-dialog-list").innerHTML=html}function openFile(){showDialogOpenFile();let fls=window.localStorage.getItem("filelist")||"[]",i;fileNameList=eval(fls);let html="<ul>";for(i in fileNameList)html+='<li class="file-item"><a href="javascript:selectFileList(\''+fileNameList[i]+"')\">"+fileNameList[i]+"</a></li>\r\n";html+="</ul>",document.getElementById("file-dialog-list").innerHTML=html}function saveFileAs(){showDialogSaveFile(currentFileName);let fls=window.localStorage.getItem("filelist")||"[]",i;fileNameList=eval(fls);let html="<ul>";for(i in fileNameList)html+='<li class="file-item"><a href="javascript:selectFileList(\''+fileNameList[i]+"')\">"+fileNameList[i]+"</li>";html+="</ul>",document.getElementById("file-dialog-list").innerHTML=html}function loadFile(){let filename=document.getElementById("filename").value;filename=filename.trim(),filename=filename.replace(/[^0-9A-Za-z_\-\(\)]/gi," "),filename=filename.replace(/ {1,}/g," ").trim(),""==filename?(alert("Silakan masukkan nama file"),document.getElementById("filename").select()):(currentFileName=filename,loadFileData(currentFileName),closeDialogFile())}function closeDialogFile(){closeEquationDialog()}function enterSign(){insertAtCursor(document.getElementById("input"),"\\\\\n")}function insertImageString(){let filename=document.getElementById("filename").value;""==filename?(alert("Silakan masukkan nama file"),document.getElementById("filename").select()):(insertAtCursor(document.getElementById("input"),"img:"+filename+" "),closeDialogFile())}function insertAudioString(){let filename=document.getElementById("filename").value;""==filename?(alert("Silakan masukkan nama file"),document.getElementById("filename").select()):(insertAtCursor(document.getElementById("input"),"audio:"+filename+"#text-top#300,40 "),closeDialogFile())}function uploadImage(){document.getElementById("image").click()}function uploadAudio(){document.getElementById("audio").click()}function uploadAudioCompress(){document.getElementById("audio2").click()}function insertImage(){let html='<div class="file-dialog">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeDialogFile();"><span></span></a><span id="file-dialog-title-label">Masukkan Gambar</span></div>\r\n    <div id="file-dialog-list"><div class="progressbar"><div class="progressbar-inner"></div></div>\r\n    <div id="remote-image-list">\r\n    </div>\r\n    </div>\r\n    <div class="file-dialog-control">\r\n    <div class="file-dialog-form">\r\n    \t <form name="filefrm" id="filefrm" onsubmit="insertImageString(); return false;">\r\n        \t <input type="text" name="filename" id="filename" autocomplete="off" style="width:calc(100% - 264px);">\r\n            <input type="button" name="openbtn" id="openbtn" value="Masukkan" onclick="insertImageString()">\r\n            <input type="button" name="uploadbtn" id="openbtn" value="Unggah" onclick="uploadImage()">\r\n            <input type="button" name="closebtn" id="closebtn" value="Batal" onclick="closeDialogFile()">\r\n        </form>\r\n    </div>\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true"),$.get("ajax-load-image.php",{test_id:testID},(function(answer){$("#remote-image-list").html(answer)})),initDragDropUpload()}function insertAudio(){let html='<div class="file-dialog">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeDialogFile();"><span></span></a><span id="file-dialog-title-label">Masukkan Suara</span></div>\r\n    <div id="file-dialog-list"><div class="progressbar"><div class="progressbar-inner"></div></div>\r\n    <div id="remote-image-list">\r\n    </div>\r\n    </div>\r\n    <div class="file-dialog-control">\r\n    <div class="file-dialog-form">\r\n    \t <form name="filefrm" id="filefrm" onsubmit="insertAudioString(); return false;">\r\n        \t <input type="text" name="filename" id="filename" autocomplete="off" style="width:calc(100% - 264px);">\r\n            <input type="button" name="openbtn" id="openbtn" value="Masukkan" onclick="insertAudioString()">\r\n            <input type="button" name="uploadbtn" id="openbtn" value="Unggah" onclick="uploadAudio()">\r\n            <input type="button" name="closebtn" id="closebtn" value="Batal" onclick="closeDialogFile()">\r\n        </form>\r\n    </div>\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true"),$.get("ajax-load-audio.php",{test_id:testID},(function(answer){$("#remote-image-list").html(answer)})),initDragDropUpload()}function compressAudio(){let html='<div class="file-dialog">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeDialogFile();"><span></span></a><span id="file-dialog-title-label">Kompres Suara</span></div>\r\n    <div id="file-dialog-list"><div class="progressbar"><div class="progressbar-inner"></div></div>\r\n    <div id="remote-image-list">\r\n    </div>\r\n    </div>\r\n    <div class="file-dialog-control">\r\n    <div class="file-dialog-form">\r\n    \t <form name="filefrm" id="filefrm" onsubmit="insertAudioString(); return false;">\r\n        \t <input type="text" name="filename" id="filename" autocomplete="off" style="width:calc(100% - 264px);">\r\n            <input type="button" name="openbtn" id="openbtn" value="Masukkan" onclick="insertAudioString()">\r\n            <input type="button" name="uploadbtn" id="openbtn" value="Unggah" onclick="uploadAudioCompress()">\r\n            <input type="button" name="closebtn" id="closebtn" value="Batal" onclick="closeDialogFile()">\r\n        </form>\r\n    </div>\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true"),$.get("ajax-load-compress-audio.php",{test_id:testID},(function(answer){$("#remote-image-list").html(answer)})),initDragDropUpload()}function showDialogOpenFile(){let html='<div class="file-dialog">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeDialogFile();"><span></span></a><span id="file-dialog-title-label">Buka Soal Ujian</span></div>\r\n    <div id="file-dialog-list">\r\n    </div>\r\n    <div class="file-dialog-control">\r\n    <div class="file-dialog-form">\r\n    \t <form name="filefrm" id="filefrm" onsubmit="loadFile(); return false;">\r\n        \t <input type="text" name="filename" id="filename">\r\n            <input type="button" name="openbtn" id="openbtn" value="Buka" onclick="loadFile()">\r\n            <input type="button" name="closebtn" id="closebtn" value="Batal" onclick="closeDialogFile()">\r\n        </form>\r\n    </div>\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true")}function showDialogDeleteFile(){let html='<div class="file-dialog">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeDialogFile();"><span></span></a><span id="file-dialog-title-label">Hapus Soal Ujian</span></div>\r\n    <div id="file-dialog-list">\r\n    </div>\r\n    <div class="file-dialog-control">\r\n    <div class="file-dialog-form">\r\n    \t <form name="filefrm" id="filefrm" onsubmit="deleteFileFromStorage(); return false;">\r\n        \t <input type="text" name="filename" id="filename">\r\n            <input type="button" name="deletebtn" id="deletebtn" value="Hapus" onclick="deleteFileFromStorage()">\r\n            <input type="button" name="closebtn" id="closebtn" value="Tutup" onclick="closeDialogFile()">\r\n        </form>\r\n    </div>\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true")}function showDialogSaveFile(filename){filename=filename||"";let html='<div class="file-dialog">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeDialogFile();"><span></span></a><span id="file-dialog-title-label">Simpan Soal Ujian</span></div>\r\n    <div id="file-dialog-list">\r\n    </div>\r\n    <div class="file-dialog-control">\r\n    <div class="file-dialog-form">\r\n    \t <form name="filefrm" id="filefrm" onsubmit="writeFile(); return false;">\r\n        \t <input type="text" name="filename" id="filename">\r\n            <input type="button" name="savebtn" id="savebtn" value="Simpan" onclick="writeFile()">\r\n            <input type="button" name="closebtn" id="closebtn" value="Batal" onclick="closeDialogFile()">\r\n        </form>\r\n    </div>\r\n    </div>\r\n</div>\r\n',el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true"),document.getElementById("filename").value=filename}function showTestInfo(test_id){let html='<div class="file-dialog">\r\n\t<div class="file-dialog-title"><a class="file-dialog-close-icon" href="javascript:closeDialogFile();"><span></span></a><span id="file-dialog-title-label">Informasi Ujian</span></div>\r\n    <div id="file-dialog-list" style="height:300px;">\r\n    </div>\r\n</div>\r\n';$.get("ajax-load-test-info.php",{test_id:test_id},(function(answer){$("#file-dialog-list").append(answer)}));let el=document.getElementById("dialog-area");el.innerHTML=html,el.setAttribute("data-dialog-shown","true")}function newFile(){let currentData=document.getElementById("input").value;contentModified?pbDialog(""!=currentFileName?{modal:!0,width:360,height:190,title:"Konfirmasi",content:"<p>Apakah Anda akan menyimpan "+currentFileName+"?</p>",buttons:{Ya:function(){saveFileData(currentFileName,currentData),animateSaving(),contentModified=!1,currentFileName="",document.getElementById("input").value="",document.getElementById("preview2").innerHTML="",closeDialog()},Tidak:function(){contentModified=!1,currentFileName="",document.getElementById("input").value="",document.getElementById("preview2").innerHTML="",closeDialog()},Batal:function(){closeDialog()}}}:{modal:!0,width:360,height:190,title:"Konfirmasi",content:"<p>Apakah Anda akan menyimpan soal-soal ini?</p>",buttons:{Ya:function(){closeDialog(),saveFileAs()},Tidak:function(){closeDialog(),contentModified=!1,currentFileName="",document.getElementById("input").value="",document.getElementById("preview2").innerHTML=""},Batal:function(){closeDialog()}}}):(currentFileName="",document.getElementById("input").value="",document.getElementById("preview2").innerHTML="")}function restartQuestion(){let startFrom=1,elemInput,elemOutput,elemStatus;modContinue=!1,document.getElementById("toolbar-continue").classList.remove("toolbar-selected"),document.getElementById("toolbar-restart").classList.add("toolbar-selected"),document.getElementById("preview1").style.display="none",$("#preview2 > ol > li:first-child").attr("value",1),renderQuestion(document.getElementById("input"),document.getElementById("preview2"),document.getElementById("status"))}let modContinue=!1;function continueQuestion(){let startFrom=1;modContinue=!0,document.getElementById("toolbar-restart").classList.remove("toolbar-selected"),document.getElementById("toolbar-continue").classList.add("toolbar-selected"),$.get("ajax-load-stored-question.php",{test_id:testID,edit_mode:editMode?1:0},(function(answer){$("#preview1").html(answer),$("#preview1").css({display:"block"}),$("#question-separator").css({display:"block"});let num=$("#preview1 > ol > li").length,elemInput,elemOutput,elemStatus;startFrom=num+1,$("#preview2 > ol > li:first-child").attr("value",startFrom),renderQuestion(document.getElementById("input"),document.getElementById("preview2"),document.getElementById("status"))})),document.getElementById("preview1").style.display="block"}function appendToTest(){let input,questions,na=noAnswer(buildQuestion(document.getElementById("input").value));if(na.length>0)pbDialog({modal:!0,width:360,height:140,title:"Soal Tidak Lengkap",content:"<p>Soal yang Anda buat tidak lengkap? Anda "+na.length+" soal yang tidak memiliki jawaban.</p>\r\n<p>Soal tanpa jawaban yaitu "+na.join(", ")+".</p>\r\n<p>Silakan perbaiki dahulu soal Anda.</p>\r\n",buttons:{Tutup:function(){closeDialog()}}});else{let startFrom=1;pbDialog({modal:!0,width:360,height:140,title:"Memasukkan Soal",content:"<p>Apakah Anda akan memasukkan soal-soal ini ke dalam ujian?</p>",buttons:{Ya:function(){let question_text=document.getElementById("input").value;$.post("ajax-append-question.php",{question_text:question_text,test_id:testID,edit_mode:editMode?1:0,option:"add"},(function(answer){$("#preview1").html(answer),$("#preview1").css({display:"block"}),$("#question-separator").css({display:"block"});let num=$("#preview1 > ol > li").length;startFrom=num+1,$("#preview2 > ol > li:first-child").attr("value",startFrom),document.getElementById("toolbar-restart").classList.remove("toolbar-selected"),document.getElementById("toolbar-continue").classList.add("toolbar-selected"),document.getElementById("preview1").style.display="block",document.getElementById("input").value="",document.getElementById("input").focus()})),closeDialog()},Tidak:function(){closeDialog()}}})}}function downloadFile(){let value=document.getElementById("input").value;value=value.replaceAll("\n","\r\n");let blob=new Blob([value],{type:"text/plain"});saveAs(blob,""!=currentFileName?currentFileName+".txt":"Soal-Ujian.txt","text/plain")}function downloadFileHTML(){let value='<!DOCTYPE html>\r\n<html xmlns="http://www.w3.org/1999/xhtml">\r\n<head>\r\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\r\n<style type="text/css">span.score{display:none;}</style>\r\n<title>Soal Ujian</title>\r\n</head>\r\n<body>\r\n'+document.getElementById("preview2").innerHTML+"\r\n</body>\r\n</html>";value=value.split('<span class="score"></span>').join("");let blob=new Blob([value],{type:"text/html"});saveAs(blob,""!=currentFileName?currentFileName+".html":"Soal-Ujian.html","text/html")}function downloadFileWord(){let value='<!DOCTYPE html>\r\n<html xmlns="http://www.w3.org/1999/xhtml">\r\n<head>\r\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\r\n<style type="text/css">span.score{display:none;} .container{} .container p, .container li{line-height:1.6;}</style>\r\n<title>Soal Ujian</title>\r\n</head>\r\n<body>\r\n<div class="container">\r\n'+document.getElementById("preview2").innerHTML+"\r\n</div>\r\n</body>\r\n</html>";value=value.split('<span class="score"></span>').join("");let blob=new Blob([value],{type:"application/vnd.doc"});saveAs(blob,""!=currentFileName?currentFileName+".doc":"Soal-Ujian.doc","application/vnd.doc")}function toXML(key,val){return"<"+key+">"+val+"</"+key+">\r\n"}function downloadFileXML(){let questions=buildQuestion(document.getElementById("input").value),i,j,question,options,option,xml;for(i in xml='<?xml version="1.0" encoding="utf-8"?>\r\n<test>\r\n',questions){for(j in question=questions[i],options=question.options,xml+="<item>\r\n",xml+="<question><text>"+question.question.escapeHTMLEntities().escapeHTML()+"</text><random>1</random><numbering>"+question.numbering+"</numbering></question>\r\n",xml+="<answer>\r\n",options)option=options[j],xml+="<option><text>"+option.text.escapeHTMLEntities().escapeHTML()+"</text><value>"+option.score+"</value></option>";xml+="</answer>\r\n",xml+="</item>\r\n"}xml+="</test>\r\n";let blob=new Blob([xml],{type:"text/xml"});saveAs(blob,""!=currentFileName?currentFileName+".xml":"Soal-Ujian.xml","text/xml")}function uploadFile(){document.getElementById("file").click()}let editMode=!1,xhr;function toggleEditMode(){editMode=!editMode,editMode?$("#toolbar-edit").addClass("toolbar-selected"):$("#toolbar-edit").removeClass("toolbar-selected"),continueQuestion()}function printDiv(divId,answer){let frm=frames.print_frame.document,style=frm.createElement("style");style.appendChild(document.createTextNode('li{\r\nline-height:1.6;\r\n} \r\nli > span{\r\ndisplay:block;\r\n}\r\nol li table{\r\nborder-collapse:collapse;\r\nmargin-top:2px;\r\nmargin-bottom:2px;\r\n}\r\nol li table td{\r\npadding:3px 5px;\r\n}\r\nol li table td table{\r\nmargin-top:0;\r\nmargin-bottom:0;\r\n}\r\nol li table[border="1"]{\r\nborder-collapse:collapse;\r\n}\r\nol li table[border="1"] td{\r\npadding:4px 5px;\r\n}\r\nol li table[border="0"] td{\r\npadding:4px 0px;\r\n}\r\nol li table[border="1"] thead td{\r\nfont-weight:bold;\r\nbackground-color:#CCCCCC;\r\n}\r\nol li table[border="1"] tfoot td{\r\nbackground-color:#F8F8F8;\r\n}\r\n'));let html=document.getElementById(divId).innerHTML,otherhead;if(answer){let obj=$('<div id="preview">'+html+"<div>");obj.find("#preview1 ol li ol li").each((function(index,element){let obj2=$(this);obj2.find(".score").length&&(obj2.css({"font-weight":"bold",color:"#06C"}),obj2.find("span").css({"font-weight":"normal",color:"#000000"}))})),obj.find("#preview2 ol li ol li").each((function(index,element){let obj2=$(this);obj2.find(".score").length&&(obj2.css({"font-weight":"bold",color:"#06C"}),obj2.find("span").css({"font-weight":"normal",color:"#000000"}))})),html=obj[0].outerHTML}window.frames.print_frame.document.body.innerHTML=html,frm.getElementsByTagName("body")[0].appendChild(style),window.frames.print_frame.window.focus(),window.frames.print_frame.window.print()}function printFile(answer){answer=answer||!1;let iframe=document.createElement("iframe"),pageBody;iframe.setAttribute("id","print_frame"),iframe.setAttribute("name","print_frame"),iframe.setAttribute("width","0"),iframe.setAttribute("height","0"),iframe.setAttribute("frameborder","0"),iframe.setAttribute("src","about:blank"),iframe.style.position="absolute",iframe.style.top="-10000px",iframe.style.left="-10000px",document.getElementsByTagName("body")[0].appendChild(iframe),printDiv("preview",answer),iframe.remove()}function animateSaving(){let el=document.createElement("div");el.setAttribute("id","animation-saving"),document.getElementsByTagName("body")[0].appendChild(el),el.setAttribute("data-anim","false"),el.setAttribute("data-anim","true"),setTimeout((function(){el.remove()}),400)}function copyExternalImage(url){$.ajax({url:"tools/ajax/upload-file-multi.php?option=copyexternal&ujian_id="+testID,data:{url:url},type:"POST",dataType:"html",success:function(data){insertAtCursor(document.getElementById("input"),"img:"+data+" ")}})}function uploadBase64Image(data,valign,ext){valign=valign||"",$(".progressbar-fixed > div").css({width:"0%"}),$(".progressbar-fixed").css({display:"block"}),$.ajax({url:"ajax-upload-file-multi.php?option=uploadbase64image&test_id="+testID,data:{data:data,ext:ext},type:"POST",dataType:"html",success:function(responseText){insertAtCursor(document.getElementById("input"),"img:"+responseText+valign+" "),$(".progressbar-fixed").css({display:"none"})},xhr:function(){let myXhr=$.ajaxSettings.xhr();return myXhr.upload&&myXhr.upload.addEventListener("progress",updateProgressFixed,!1),myXhr}})}function uploadBase64ImageFromLatex(data,editor,ext,latex){ext=ext||"png",$(".progressbar-fixed > div").css({width:"0%"}),$(".progressbar-fixed").css({display:"block"}),$.ajax({url:"ajax-upload-file-multi.php?option=uploadbase64image&test_id="+testID,data:{data:data,ext:ext},type:"POST",dataType:"html",success:function(responseText){let desc=" ",elemInput,elemOutput,elemStatus;latex&&(desc="##"+encodeURIComponent(latex)),insertAtCursor(document.getElementById("input"),"img:"+responseText+"#middle"+desc+" "),renderQuestion(document.getElementById("input"),document.getElementById("preview2"),document.getElementById("status")),closeEquationDialog(),$(".progressbar-fixed").css({display:"none"})},xhr:function(){let myXhr=$.ajaxSettings.xhr();return myXhr.upload&&myXhr.upload.addEventListener("progress",updateProgressFixed,!1),myXhr}})}function handlePasteImage(e){if(e&&e.clipboardData&&e.clipboardData.getData)if(/Files/.test(e.clipboardData.types)&&!/text\/html/.test(e.clipboardData.types)){let blob=e.clipboardData.items[0].getAsFile(),reader=new window.FileReader;reader.readAsDataURL(blob),reader.onloadend=function(){uploadBase64Image(reader.result,"#text-top")},e.preventDefault&&(e.stopPropagation(),e.preventDefault())}else if(/Files/.test(e.clipboardData.types)&&/text\/html/.test(e.clipboardData.types)){let html=e.clipboardData.getData("text/html"),container=document.createElement("div");container.innerHTML=html;let nimage=0;for(let i in container.childNodes){if("IMG"==container.childNodes.item(i).tagName||"img"==container.childNodes.item(i).tagName){let url;copyExternalImage(container.childNodes.item(i).getAttribute("src"))}nimage++}nimage>0&&e.preventDefault&&(e.stopPropagation(),e.preventDefault())}else if(/text\/html/.test(e.clipboardData.types)){let data=e.clipboardData.getData("text/html");try{e.clipboardData.setData("text/plain",data)}catch(e){}e.preventDefault}else/text\/plain/.test(e.clipboardData.types)}function updateProgress(evt){if(evt.lengthComputable){let percentComplete=evt.loaded/evt.total;$(".progressbar-inner").css({width:100*percentComplete+"%"})}}function updateProgressFixed(evt){if(evt.lengthComputable){let percentComplete=evt.loaded/evt.total;$(".progressbar-fixed-inner").css({width:100*percentComplete+"%"})}}function pbDialog(options){let i;options=options||{};let settings={content:"",width:300,height:120,modal:!1,title:"Dialog",buttons:{OK:function(){},Cancel:function(){}}};for(let key in settings)settings.hasOwnProperty(key)&&void 0===options[key]&&(options[key]=settings[key]);for(i in this.container=document.createElement("div"),this.container.classList.add("pb-dialog-container"),this.dialog=document.createElement("div"),this.dialog.classList.add("pb-dialog"),this.title=document.createElement("div"),this.title.classList.add("pb-dialog-title"),this.title.innerHTML="<h3>"+options.title+"</h3>",this.content=document.createElement("div"),this.content.classList.add("pb-dialog-content"),this.content.innerHTML=options.content,this.buttons=document.createElement("div"),this.buttons.classList.add("pb-dialog-buttons"),options.buttons){let btn=document.createElement("button");btn.innerHTML=i,btn.addEventListener("click",options.buttons[i]),this.buttons.appendChild(btn),this.buttons.appendChild(document.createTextNode(" "))}options.modal&&(this.cover=document.createElement("div"),this.cover.classList.add("pb-dialog-cover"),this.container.appendChild(this.cover)),this.container.appendChild(this.dialog),this.dialog.appendChild(this.title),this.dialog.appendChild(this.content),this.dialog.appendChild(this.buttons),document.getElementsByTagName("body")[0].appendChild(this.container)}function closeDialog(){document.getElementsByClassName("pb-dialog-container")[0].remove()}function insertAtCursor(myField,myValue){if(document.selection){let sel;myField.focus(),document.selection.createRange().text=myValue}else if(myField.selectionStart||"0"==myField.selectionStart){let startPos=myField.selectionStart,endPos=myField.selectionEnd;myField.value=myField.value.substring(0,startPos)+myValue+myField.value.substring(endPos,myField.value.length),myField.setSelectionRange(startPos+myValue.length,startPos+myValue.length),myField.focus()}else myField.value+=myValue,myField.focus()}function refreshList(testID){$.get("ajax-load-image.php",{test_id:testID},(function(answer){$("#remote-image-list").html(answer)}))}if(window.onload=function(){document.getElementById("input").addEventListener("change",(function(e){inputChanged(e),contentModified=!0})),document.getElementById("input").addEventListener("keyup",(function(e){let event;void 0!==document.createEvent?(event=document.createEvent("KeyboardEvent"),event.initEvent("change",!0,!0)):event=new Event("change"),e.target.dispatchEvent(event)})),document.getElementById("input").addEventListener("focus",(function(e){let event;void 0!==document.createEvent?(event=document.createEvent("KeyboardEvent"),event.initEvent("change",!0,!0)):event=new Event("change"),e.target.dispatchEvent(event)})),document.getElementById("input").addEventListener("keydown",(function(e){83==e.keyCode&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),""!=currentFileName?(saveFileData(currentFileName,e.target.value),animateSaving()):saveFileAs()),(69==e.keyCode||81==e.keyCode)&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(showLatexDialog(),e.preventDefault(),e.stopPropagation()),87==e.keyCode&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),e.stopPropagation())})),document.getElementById("input").addEventListener("keypress",(function(e){((13==e.keyCode||10==e.keyCode)&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)||(13==e.keyCode||10==e.keyCode)&&(navigator.platform.match("Mac")?e.metaKey:e.shiftKey))&&(insertAtCursor(e.target,"\\\\\n"),e.preventDefault(),e.stopPropagation())})),document.getElementById("input").addEventListener("paste",(function(e){let event;handlePasteImage(e),setTimeout((function(){void 0!==document.createEvent?(event=document.createEvent("KeyboardEvent"),event.initEvent("change",!0,!0)):event=new Event("change"),e.target.dispatchEvent(event)}),500)})),document.getElementById("input").focus(),document.getElementById("file").onchange=function(){let file=this.files[0],reader=new FileReader;reader.onload=function(progressEvent){let lines=this.result;document.getElementById("input").value=lines,document.getElementById("input").focus()},reader.readAsText(file)},document.getElementById("audio").onchange=function(){let test_id=testID,file=this.files[0],frmdata=new FormData;frmdata.append("audios[]",file),$(".progressbar > div").css({width:"0%"}),$(".progressbar").css({display:"block"}),$.ajax({url:"ajax-upload-audio-multi.php?test_id="+test_id,type:"POST",processData:!1,data:frmdata,dataType:"text",contentType:!1,success:function(responseText){$("#remote-image-list").empty().append(responseText),$(".progressbar").css({display:"none"})},xhr:function(){let myXhr=$.ajaxSettings.xhr();return myXhr.upload&&myXhr.upload.addEventListener("progress",updateProgress,!1),myXhr}})},document.getElementById("audio2").onchange=function(){let test_id=testID,file=this.files[0],frmdata=new FormData;frmdata.append("audios[]",file),$(".progressbar > div").css({width:"0%"}),$(".progressbar").css({display:"block"}),$.ajax({url:"ajax-upload-audio-multi.php?option=compress&test_id="+test_id,type:"POST",processData:!1,data:frmdata,dataType:"text",contentType:!1,success:function(responseText){$("#remote-image-list").empty().append(responseText),$(".progressbar").css({display:"none"})},xhr:function(){let myXhr=$.ajaxSettings.xhr();return myXhr.upload&&myXhr.upload.addEventListener("progress",updateProgress,!1),myXhr}})},$(document).on("change","#image",(function(e){FileSelectHandler(e)})),$(document).on("click","#remote-image-list .img-li a, #remote-image-list .select-audio a",(function(e){let name=$(this).attr("data-name");$("#filename").val(name),e.preventDefault()})),$(document).on("change","#file",(function(e){})),$(document).on("click",".compress-audio-file",(function(e){let filename=$(this).attr("data-name"),tr=$(this).closest("tr"),no=tr.find("td:first-child").text().toString().trim(),test_id=testID,object=$(this);pbDialog({modal:!0,width:360,height:190,title:"Konfirmasi",content:"<p>Mengompres file akan memperkecil ukuran file dan menurunkan kualitas suara. Pastikan bahwa Anda tidak mengompres file yang sama lebih dari satu kali.<br />Apakah Anda akan mengompres file "+filename+"?</p>",buttons:{Ya:function(){object.replaceWith('<span class="animation-pressure"><span></span></span>'),$.post("ajax-compress-audio-file.php",{filename:filename,no:no,test_id:test_id},(function(answer){tr.replaceWith(answer)})),closeDialog()},Tidak:function(){closeDialog()}}})})),$(document).on("click","#toolbar-info",(function(e){let test_id;showTestInfo($(this).attr("data-test-id"))})),contentModified=!1},window.XMLHttpRequest)xhr=new XMLHttpRequest;else{let versions=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"];for(let i=0,len=versions.length;i<len;i++)try{xhr=new ActiveObject(versions[i]);break}catch(e){}}function initDragDropUpload(){if(window.File&&window.FileList&&window.FileReader){let filedrag=$("#remote-image-list")[0];xhr.upload&&(filedrag.addEventListener("dragenter",FileDragHover,!1),filedrag.addEventListener("dragexit",FileDragHover,!1),filedrag.addEventListener("dragover",FileDragHover,!1),filedrag.addEventListener("dragleave",FileDragHover,!1),filedrag.addEventListener("drop",FileSelectHandler,!1),filedrag.style.display="block")}}function progressHandler(event){let percent=event.loaded/event.total*100;$(".progressbar-inner").css({width:percent+"%"})}function completeHandler(event){let response=event.target.responseText;$(".progressbar-inner").css({width:"0%"}),""!=response&&$(".progressbar").css({display:"none"})}function errorHandler(event){alert("Terjadi kesalahan.")}function abortHandler(event){alert("Proses dibatalkan")}function FileDragHover(e){e.stopPropagation(),e.preventDefault(),"dragover"==e.type?$("#remote-image-list").addClass("file-area-hover"):$("#remote-image-list").removeClass("file-area-hover")}function FileSelectHandler(e){FileDragHover(e);let test_id=testID,textData;if(textData=void 0!==e.dataTransfer&&e.dataTransfer.getData("Text")||"",textData.indexOf("://")>-1)$.post("ajax-upload-file-multi.php?option=transfer&test_id="+test_id,{url:textData},(function(answer){refreshList(test_id)}));else{let files=e.target.files||e.dataTransfer.files,formData=new FormData;for(let i=0;i<files.length&&!(i>=maxUploadFile-1);i++)formData.append("images[]",files[i]);$(".progressbar").css({display:"block"}),xhr.open("POST","ajax-upload-file-multi.php?test_id="+testID),xhr.onload=function(){200===xhr.status&&($("#remote-image-list").html(xhr.responseText),$(".progressbar").css({display:"none"}))},xhr.upload.addEventListener("progress",progressHandler,!1),xhr.addEventListener("load",completeHandler,!1),xhr.addEventListener("error",errorHandler,!1),xhr.addEventListener("abort",abortHandler,!1),xhr.send(formData)}}